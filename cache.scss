
// 将字符串分割组成一个列表
// $sort：0为正序，1为倒序
@function fn_stringToList($str, $sort:0) {
  $list: ();
  $len: str-length($str);
  @if $sort == 0 {
    @for $i from 1 through $len {
      $list: append($list, str-slice($str, $i, $i));
    }
  } @else {
    @while $len > 0 {
      $list: append($list, str-slice($str, $len, $len));
      $len: $len - 1;
    }
  }
  @return $list;
}

// 去除列表中的某一项
@function fn_removeListItem($list, $index){
  $str: '';
  @for $i from 1 through length($list) {
    @if($i != $index) {
      $str: $str + nth($list, $i);
    }
  }
  @return fn_stringToList($str, 0);
}

// 将含有字符串的列表转换成数值列表
@function fnStringListToNumberList($list) {
  @for $i from 1 through length($list) {
    @for $num from 0 through 9{
      // @error '这是' $num $len;
      @if(quote($num) == nth($list, $i)) {
        $list: set-nth($list, $i , $num);
      } 
    }
  }
  @return $list;
}

// 将字符串转换成数字类型
@function fn_stringToNumber($str) {
  // 定义返回值
  $resNum: 0;
  // 将字符串分割后存放到列表，按倒序的方式放入
  $list: fn_stringToList($str, 1);  
  // 如果是负数的情况
  $neg: 1;
  // 因为是倒序，所以如果有，则负号在最后面
  // @if(nth())
  @if index($list, '-') {
    // $list: set-nth($list, index($list, '-'), null);
    $neg: -1;
    $list: fn_removeListItem($list, index($list, '-'));
  }
  // 如果是有百分号的情况
  $per: 1;
  @if index($list, '%') {
    $per: 100;
    $list: fn_removeListItem($list, index($list, '%'));
  }
  // 将所有数转换为数值
  $list: fnStringListToNumberList($list);
  
  // 判断数值是否合法
  $testList: fnStringListToNumberList(fn_removeListItem($list, index($list, '.')));
  // @error $testList;
  @each $v in $testList {
    @if type-of($v) != number {
      // @error "不是合法的数值，请重新输入";
      @return "不是合法的数值，请重新输入";
    }
  }

  // 1、如果是有小数点的情况
  // 存放小数点左右两边最大索引值
  $listLen: length($list);
  $hasDot: if(index($list, '.'), true, false);
  $dotIdx: if($hasDot, index($list, '.'), 0);
  $x: $dotIdx - 1;
  $y: $dotIdx + 1;
  // @error $x '+' $list '+' $y;
  @if $x > -1 {
    // 小数点右边
    @for $i from 1 through $x {
      $temp: nth($list, $i);
      $z: $x - $i + 1;
      @while $z > 0 {
        $z: $z - 1;
        $temp: $temp*0.1;
      }
      $resNum: $resNum + $temp;
    }
    // 小数点左边
    // 个位情况
    $resNum: $resNum + nth($list, $y);
    // @error $resNum;
  }
  // 2、如果是整数
  @if $x = -1 {
    $resNum: $resNum + nth($list, $y);
  }
  // 如果数值小于1的情况
  @if $listLen > $y {
    @for $i from $listLen through ($y + 1) {
      $t: $i - $y;
      $temp: nth($list, $i);
      @while $t > 0 {
        $t: $t - 1;
        $temp: $temp * 10;
      }
      $resNum: $resNum + $temp;
    }
  }
  
  // 3、负数
  $resNum: $resNum * $neg;
  // 4、百分比
  @if($per == 100) {
    $resNum: $resNum / $per;
    $resNum: percentage($resNum);
  }
  @return $resNum;
}